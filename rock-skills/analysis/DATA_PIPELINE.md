# ROCK Skills Data Pipeline Documentation

## Overview

This document describes the complete data pipeline for generating master concepts from ROCK skills variant analysis and integrating them into the Skills Bridge Explorer application.

```
┌──────────────────────────────────────────────────────────────────────────┐
│                           DATA PIPELINE FLOW                              │
└──────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐
│  ROCK Schemas   │  (Source: rock_schemas/*.csv)
│  - SKILLS.csv   │  • 8,224 total ROCK skills
│  - STANDARDS... │  • Cross-state skill definitions
└────────┬────────┘
         │
         v
┌─────────────────────────────┐
│  Variant Classification     │  Script: analysis/variant_classifier.py
│  (State A & State B)        │  Output: outputs/variant-classification-report.csv
└────────┬────────────────────┘
         │  • State A: Cross-state variants (38 skills in 13 groups)
         │  • State B: Grade progressions (589 skills)
         │  • Unique: No variants (2,373 skills)
         │
         v
┌─────────────────────────────┐
│  LLM Taxonomy Mappings      │  Script: analysis/scripts/batch_map_skills.py
│  (AI-assisted)              │  Output: analysis/llm_skill_mappings.csv
└────────┬────────────────────┘
         │  • 1,600 skills mapped to SoR taxonomy
         │  • Semantic similarity + Claude Sonnet 4.5
         │  • Confidence levels: High/Medium/Low
         │
         v
┌─────────────────────────────┐
│  Master Concepts Generator  │  Script: analysis/scripts/generate_master_concepts.py
│  (Hybrid Approach)          │  
└────────┬────────────────────┘
         │  LOGIC:
         │  1. Extract State A groups (cross-state variants)
         │  2. Join with LLM mappings for taxonomy enrichment
         │  3. Aggregate to determine consensus taxonomy
         │  4. Extract master concept from Skill Area/Subset level
         │  5. Calculate metrics (skill_count, authorities, grade_range)
         │  6. Link State B skills via taxonomy similarity
         │
         v
┌──────────────────────────────────────────────────────────┐
│  GENERATED DATA FILES                                     │
│  ├─ master-concepts.csv               (13 concepts)      │
│  │  • Master concept definitions                         │
│  │  • Taxonomy mappings                                  │
│  │  • Fragmentation metrics                              │
│  │                                                        │
│  └─ skill_master_concept_mapping.csv  (3,000 mappings)  │
│     • SKILL_ID → MASTER_CONCEPT_ID bridge table         │
│     • Includes State A, State B, and unique skills      │
└────────┬───────────────────────────────────────────────────┘
         │
         v
┌─────────────────────────────┐
│  Validation                 │  Script: analysis/scripts/validate_data_pipeline.py
│                             │  Output: analysis/data_validation_report.txt
└────────┬────────────────────┘
         │  • File existence checks
         │  • Data integrity validation
         │  • Relationship consistency
         │  • Quality metrics
         │
         v
┌─────────────────────────────┐
│  Skills Bridge Explorer     │  App: poc/skill_bridge_app.py
│  (Streamlit Application)    │  Data Loader: poc/data_loader.py
└─────────────────────────────┘
     • Home Page (updated metrics)
     • Master Concept Browser (shows generated concepts)
     • Content Scaling Simulator
     • Variant Analysis
     • And more...
```

---

## Data Sources

### 1. ROCK Schemas (`rock_schemas/`)
**Purpose**: Original ROCK skills data from state standards

**Key Files**:
- `SKILLS.csv` (8,224 skills)
  - SKILL_ID, SKILL_NAME, SKILL_AREA_NAME
  - CONTENT_AREA_NAME, GRADE_LEVEL_NAME
- `STANDARDS.csv` (state standards)
- `STANDARD_SKILLS.csv` (skill → standard relationships)
- `STANDARD_SETS.csv` (standard sets by state/authority)

**Note**: These files are READ-ONLY. Pipeline does not modify ROCK schemas.

### 2. Science of Reading Taxonomy
**File**: `POC_science_of_reading_literacy_skills_taxonomy.csv`

**Structure**:
- 6-level hierarchy: Strand → Pillar → Domain → Skill Area → Skill Set → Skill Subset
- 1,139 taxonomy entries
- Evidence-based framework grounded in reading research
- Consistent terminology across applications

### 3. Variant Classification
**File**: `analysis/outputs/variant-classification-report.csv`

**Generated By**: `analysis/variant_classifier.py`

**Content**:
- SKILL_ID, SKILL_NAME, GRADE_LEVEL_NAME
- EQUIVALENCE_TYPE: state-variant | grade-progression | unique
- EQUIVALENCE_GROUP_ID: Groups related skills
- AUTHORITY: State/authority name

**Metrics** (as of Oct 15, 2025):
- Total skills analyzed: 3,000 (ELA subset)
- State A (cross-state): 38 skills in 13 groups
- State B (progressions): 589 skills
- Unique skills: 2,373

### 4. LLM Skill Mappings
**File**: `analysis/llm_skill_mappings.csv`

**Generated By**: `analysis/scripts/batch_map_skills.py`

**Content**:
- SKILL_ID, SKILL_NAME
- TAXONOMY_PATH: Full SoR taxonomy path
- CONFIDENCE: High | Medium | Low
- SEMANTIC_SIMILARITY: 0.0-1.0 score
- strand, pillar, domain, skill_area, skill_subset

**Metrics** (as of Oct 15, 2025):
- Total mapped: 1,600 skills
- High confidence: ~60%
- Medium confidence: ~30%
- Low confidence: ~10%

---

## Generated Data Files

### 1. Master Concepts (`analysis/master-concepts.csv`)

**Generated By**: `analysis/scripts/generate_master_concepts.py`

**Columns**:
- `MASTER_CONCEPT_ID`: Unique ID (format: MC-SA-####)
- `MASTER_CONCEPT_NAME`: Extracted from taxonomy (Skill Area or Skill Subset)
- `SOR_STRAND`: Science of Reading strand
- `SOR_PILLAR`: Science of Reading pillar
- `SOR_DOMAIN`: Science of Reading domain
- `DESCRIPTION`: From taxonomy annotation
- `SKILL_COUNT`: Number of skill variants
- `AUTHORITY_COUNT`: Number of states/authorities represented
- `GRADE_RANGE`: Grade range (e.g., "K to Grade 2")
- `EQUIVALENCE_GROUP_ID`: Link to variant analysis (State A group)
- `TAXONOMY_CONFIDENCE`: High | Medium | Low

**Current Metrics**:
- Total concepts: 13
- High confidence: 10
- Medium confidence: 2
- Low confidence: 1
- Average skills per concept: 2.9
- Max skills in one concept: 5

**Generation Logic**:
1. Extract State A variant groups from classification
2. For each group, get skill IDs
3. Join with LLM mappings to get taxonomy paths
4. Determine consensus taxonomy path (most common)
5. Extract master concept name from taxonomy (Skill Area level)
6. Get description from taxonomy annotations
7. Calculate metrics: skill_count, authority_count, grade_range
8. Determine confidence based on LLM mapping confidence distribution

### 2. Skill-to-Master-Concept Mapping (`analysis/skill_master_concept_mapping.csv`)

**Generated By**: `analysis/scripts/generate_master_concepts.py`

**Columns**:
- `SKILL_ID`: ROCK skill ID
- `SKILL_NAME`: ROCK skill name
- `MASTER_CONCEPT_ID`: Reference to master-concepts.csv (NULL if unmapped)
- `MASTER_CONCEPT_NAME`: Master concept name
- `EQUIVALENCE_TYPE`: state-variant | grade-progression | unique
- `TAXONOMY_PATH`: Full SoR taxonomy path from LLM mappings
- `CONFIDENCE`: High | Medium | Low from LLM mappings

**Current Metrics**:
- Total skills: 3,000
- Mapped to master concepts: 212
  - State A (direct mapping): 38
  - State B (taxonomy similarity): 174
- Unmapped (unique): 2,788

**Mapping Logic**:
- **State A skills**: Direct mapping via EQUIVALENCE_GROUP_ID
- **State B skills**: Mapped via taxonomy similarity to existing concepts
- **Unique skills**: Left unmapped (MASTER_CONCEPT_ID = NULL)

---

## Scripts & Tools

### 1. Master Concepts Generator
**Script**: `analysis/scripts/generate_master_concepts.py`

**Purpose**: Generate master concepts from State A groups enriched with taxonomy

**Usage**:
```bash
cd rock-skills/analysis
python3 scripts/generate_master_concepts.py
```

**Outputs**:
- `master-concepts.csv`
- `skill_master_concept_mapping.csv`

**Dependencies**:
- `outputs/variant-classification-report.csv`
- `llm_skill_mappings.csv`
- `POC_science_of_reading_literacy_skills_taxonomy.csv`
- `rock_schemas/SKILLS.csv`

### 2. Data Validation
**Script**: `analysis/scripts/validate_data_pipeline.py`

**Purpose**: Validate data integrity and relationships

**Usage**:
```bash
cd rock-skills/analysis
python3 scripts/validate_data_pipeline.py
```

**Checks**:
- ✓ All required files exist and are readable
- ✓ Master concepts have valid structure
- ✓ Skill mappings reference valid IDs
- ✓ No orphaned records
- ✓ Data relationships are consistent
- ✓ Grade ranges and confidence values are valid

**Output**: `data_validation_report.txt`

### 3. Variant Classifier
**Script**: `analysis/variant_classifier.py`

**Purpose**: Identify State A (cross-state) and State B (grade progression) variants

**Usage**:
```bash
cd rock-skills/analysis
python3 variant_classifier.py
```

**Output**: `outputs/variant-classification-report.csv`

**Note**: This is a prerequisite for master concepts generation.

### 4. LLM Batch Mapper
**Script**: `analysis/scripts/batch_map_skills.py`

**Purpose**: Map ROCK skills to SoR taxonomy using AI assistance

**Usage**:
```bash
cd rock-skills/analysis
python scripts/batch_map_skills.py \
    --content-area "English Language Arts" \
    --checkpoint-interval 10 \
    --output-dir ./outputs/my_batch
```

**Note**: Requires AWS Bedrock access for Claude Sonnet 4.5

---

## Application Integration

### Data Loader (`poc/data_loader.py`)

**New Methods Added**:

#### Master Concepts
```python
# Load master concepts
loader.load_master_concepts() -> pd.DataFrame

# Load skill-to-concept mapping
loader.load_skill_master_concept_mapping() -> pd.DataFrame

# Get concept by ID
loader.get_master_concept_by_id(concept_id) -> pd.Series

# Get skills for a concept
loader.get_skills_by_master_concept_id(concept_id) -> pd.DataFrame

# Reverse lookup: skill → concept
loader.get_master_concept_for_skill(skill_id) -> Dict
```

#### Variant Analysis
```python
# Get State A groups summary
loader.get_state_a_groups_summary() -> pd.DataFrame

# Get skills in an equivalence group
loader.get_equivalence_group_details(group_id) -> pd.DataFrame
```

### Application Pages

#### Updated Pages:
1. **Home Page** - Uses real master concepts in metrics
2. **Master Concept Browser** - Displays generated master concepts with variant details
3. **Variant Analysis** - Shows State A/B groups

#### Key Features:
- Real-time metrics from generated data
- Filterable master concept browser
- Fragmentation visualization
- State-by-state variant breakdown
- Confidence indicators

---

## Data Refresh Procedures

### When to Regenerate Master Concepts

**Trigger Events**:
1. New LLM mappings added to `llm_skill_mappings.csv`
2. Variant classification updated
3. Science of Reading taxonomy updated
4. Manual review suggests improvements

### Full Pipeline Refresh

**Step 1: Update Variant Classification** (if needed)
```bash
cd rock-skills/analysis
python3 variant_classifier.py
```

**Step 2: Update LLM Mappings** (if needed)
```bash
cd rock-skills/analysis
python scripts/batch_map_skills.py \
    --skill-ids-file new_skills.txt \
    --content-area "English Language Arts" \
    --output-dir ./outputs/new_batch
```

**Step 3: Regenerate Master Concepts**
```bash
cd rock-skills/analysis
python3 scripts/generate_master_concepts.py
```

**Step 4: Validate Data**
```bash
cd rock-skills/analysis
python3 scripts/validate_data_pipeline.py
```

**Step 5: Test Application**
```bash
cd rock-skills/poc
streamlit run skill_bridge_app.py
```

Navigate to Master Concept Browser to verify new data loads correctly.

---

## Quality Metrics

### Confidence Thresholds

**High Confidence** (≥0.70 semantic similarity):
- Direct match between ROCK skill and taxonomy
- Use as-is without review
- Suitable for production

**Medium Confidence** (0.50-0.69):
- Good match with minor differences
- Light review recommended
- Generally acceptable

**Low Confidence** (<0.50):
- Requires expert review
- May need remapping
- Use with caution

### Validation Criteria

**Master Concepts**:
- ✓ All MASTER_CONCEPT_IDs unique
- ✓ No null values in critical fields
- ✓ SKILL_COUNT > 0
- ✓ Valid confidence values
- ✓ Valid grade ranges

**Skill Mappings**:
- ✓ All SKILL_IDs exist in SKILLS.csv
- ✓ All MASTER_CONCEPT_IDs exist in master-concepts.csv
- ✓ Valid equivalence types
- ✓ No orphaned mappings

---

## Troubleshooting

### Issue: Master concepts not showing in app

**Check**:
1. File exists: `analysis/master-concepts.csv`
2. File has content (>1 row)
3. Streamlit cache cleared (restart app)

**Solution**:
```bash
cd rock-skills/analysis
python3 scripts/generate_master_concepts.py
cd ../poc
streamlit run skill_bridge_app.py
```

### Issue: Validation fails

**Check**:
1. All prerequisite files exist
2. No manual edits to generated files
3. Column names match exactly

**Solution**: Regenerate from scratch following "Full Pipeline Refresh" above

### Issue: Low concept count

**Explanation**: Current implementation only generates concepts from State A groups (cross-state variants with 2+ skills). This is intentional - State B (grade progressions) and unique skills are mapped to concepts but don't create new concepts.

**To increase concept count**: Run LLM mappings on more skills to identify more State A variant groups.

---

## Future Enhancements

### Short-Term
- [ ] Generate concepts from high-confidence State B chains
- [ ] Add singleton concepts for critical unique skills
- [ ] Improve authority extraction (currently "Unknown" for many)
- [ ] Add concept versioning/history

### Long-Term
- [ ] ML-based variant detection (replace string similarity)
- [ ] Automated concept name generation
- [ ] Multi-taxonomy support (Math, Science)
- [ ] Real-time concept updates in application
- [ ] Collaborative concept refinement interface

---

## References

- **Problem Statement**: `docs/2-problem-statement.md`
- **Schema Overview**: `docs/1-schema-overview.md`
- **Demo Guide**: `DEMO_TEST_GUIDE.md`
- **Analysis README**: `analysis/README.md`

---

**Last Updated**: October 15, 2025
**Pipeline Version**: 1.0
**Status**: ✅ Operational

